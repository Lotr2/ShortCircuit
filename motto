import subprocess
import os
import sys

def set_text_wallpaper(text, output_path='wallpaper.png', 
                       width=1920, height=1080, 
                       font='DejaVu-Sans', pointsize=48, 
                       fill='white'):
    try:
        subprocess.run([
            'convert',
            '-size', f'{width}x{height}',
            'xc:black',
            '-font', font,
            '-pointsize', str(pointsize),
            '-fill', fill,
            '-gravity', 'center',
            '-annotate', '+0+0', text,
            output_path
        ], check=True)
    except Exception as e:
        raise RuntimeError(f"Image generation failed: {str(e)}") from None

    try:
        abs_path = os.path.abspath(output_path)
        subprocess.run([
            'gsettings', 'set', 
            'org.gnome.desktop.background', 
            'picture-uri-dark',
            f'file://{abs_path}'
        ], check=True)
    except Exception as e:
        raise RuntimeError(f"Wallpaper setting failed: {str(e)}") from None

    return f"Success! Wallpaper updated with text: '{text}'"

if __name__ == '__main__':
    if len(sys.argv) > 1:
        # Join all arguments as the text
        input_text = " ".join(sys.argv[1:])
    else:
        input_text = "Default Wallpaper Text"
    set_text_wallpaper(input_text)
